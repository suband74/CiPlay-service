# Микросервис для счетчиков статистики.

## Общее описание

1. API методы:
 - Метод сохранения статистики POST `http://localhost:8004/events`
 - Метод показа статистики GET `http://localhost:8004/events`
 - Метод сброса статистики DELETE `http://localhost:8004/events`

2. Метод сохранения статистики принимает на вход:
    - date - дата события
    - views - количество показов
    - clicks - количество кликов
    - сost - стоимость кликов (в рублях с точностью до копеек)
    - Поля views, clicks и cost - опциональные.
    - Исключительно в целях демонстрации добавил валидацию по условию что количество показов не может быть меньше количества кликов.

3. Статистика агрегируется по дате.
4. Метод показа статистики принимает на вход:
    - from_date - дата начала периода (включительно)
    - to_date - дата окончания периода (включительно)
    - order_field - выбор поля для сортировки по любому из полей ответа
5. Отвечает статистикой, отсортированной по выбранному полю.
6. В ответе поля:
    - event_date - дата события
    - views - количество показов
    - clicks - количество кликов
    - cost - стоимость кликов
    - cpc = cost/clicks (средняя стоимость клика)
    - cpm = cost/views * 1000 (средняя стоимость 1000 показов)
7. Метод сброса статистики - удаляет всю сохраненную статистику.
8. Все методы доступны также в интерактивной оболочке по адресу: `http://localhost:8004/docs`

## Установка проекта на локальный компьютер:

1. Должен быть предустановлен менеджер зависимостей `poetry`. Или установите `poetry` любым удобным способом. 
   Например: `curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python -` 
2. Выполните клонирование репозитория: `https://github.com/suband74/CiPlay-service`
3. Затем выполните установку зависимостей проекта: `poetry install`
4. Установить `docker` и `docker-compose`. Инструкции по установке доступны в официальной документации.
5. В папке с проектом выполнить команду:
```
docker-compose up
```